<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astrological and Numerological Blueprint Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-color: #1a202c;
            --card-background: #2d3748;
            --text-color: #e2e8f0;
            --heading-color: #ffffff;
            --accent-color: #805ad5;
            --accent-hover: #6b46c1;
            --border-color: #4a5568;
            --pre-background: #171923;
            --aspect-hard: #e53e3e;
            --aspect-soft: #3182ce;
            --aspect-neutral: #38a169;
        }
        
        body {
            font-family: 'Inter', sans-serif; line-height: 1.7; padding: 2rem; margin: 0;
            background-color: var(--background-color); color: var(--text-color);
            display: flex; flex-direction: column; align-items: center;
        }
        .container { max-width: 800px; width: 100%; }
        h1, h2 { color: var(--heading-color); text-align: center; font-weight: 700; }
        h1 { font-size: 2.25rem; margin-bottom: 0.5rem; }
        h2 { margin-top: 3rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem; }
        .description { background-color: var(--card-background); padding: 1.5rem 2rem; border-radius: 8px; margin: 1.5rem 0; border: 1px solid var(--border-color); }
        .description h3 { margin-top: 0; color: var(--heading-color); }
        .description a { color: var(--accent-color); text-decoration: none; }
        .description a:hover { text-decoration: underline; }
        form { background: var(--card-background); padding: 2rem; border-radius: 8px; border: 1px solid var(--border-color); }
        label { font-weight: 500; display: block; margin-top: 1rem; margin-bottom: 0.5rem; }
        input[type="text"], input[type="number"], select { display: block; width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 6px; box-sizing: border-box; background-color: var(--background-color); color: var(--text-color); font-size: 1rem; }
        input:focus, select:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(128, 90, 213, 0.3); }
        button { width: 100%; padding: 0.85rem; font-size: 1.1rem; font-weight: 500; color: #fff; background-color: var(--accent-color); border: none; border-radius: 6px; cursor: pointer; margin-top: 2rem; transition: background-color 0.2s ease-in-out; }
        button:hover:not(:disabled) { background-color: var(--accent-hover); }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        pre { background: var(--pre-background); padding: 1.5rem; border: 1px solid var(--border-color); border-radius: 8px; white-space: pre-wrap; word-break: break-word; font-family: "Courier New", Courier, monospace; font-size: 14px; color: var(--text-color); }
        #chart-wheel-container { display: flex; justify-content: center; align-items: center; margin-top: 2rem; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; }
        #chart-wheel-svg { width: 100%; height: auto; aspect-ratio: 1 / 1; background-color: var(--pre-background); border-radius: 50%; }
        .wheel-circle { stroke: var(--border-color); stroke-width: 2; fill: none; }
        .zodiac-divider { stroke: var(--border-color); stroke-width: 1; }
        .house-cusp { stroke: var(--text-color); stroke-width: 2; }
        .house-cusp.major { stroke-width: 4; }
        .house-number { fill: var(--text-color); font-size: 28px; font-family: 'Inter', sans-serif; text-anchor: middle; dominant-baseline: middle; }
        .zodiac-glyph { fill: var(--text-color); font-size: 35px; text-anchor: middle; dominant-baseline: middle; }
        .planet-glyph { fill: var(--heading-color); font-size: 35px; text-anchor: middle; dominant-baseline: middle; }
        .planet-retrograde { fill: var(--text-color); font-size: 20px; }
        .aspect-line { stroke-width: 1.5; opacity: 0.7; }
        .aspect-conjunction { stroke: var(--aspect-neutral); }
        .aspect-opposition, .aspect-square { stroke: var(--aspect-hard); }
        .aspect-trine, .aspect-sextile { stroke: var(--aspect-soft); }
        .aspect-quincunx, .aspect-semisextile, .aspect-semisquare, .aspect-sesquiquadrate, .aspect-quintile, .aspect-biquintile { stroke: var(--border-color); stroke-dasharray: 4 4; }
        .time-toggle { display: flex; align-items: center; margin-top: 1.5rem; }
        .time-toggle input { width: auto; margin-right: 0.75rem; }
        .time-toggle label { margin: 0; }
        .time-note { font-size: 0.9rem; color: #a0aec0; margin-top: 1.5rem; }
        .analysis-note { text-align: center; margin: 1rem 0; font-size: 0.9rem; color: #a0aec0; }
        .privacy-section { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); font-size: 0.9rem; color: #a0aec0; }
        .privacy-section details { background-color: var(--card-background); border-radius: 8px; border: 1px solid var(--border-color); padding: 1rem 1.5rem; margin-bottom: 1rem; }
        .privacy-section summary { font-weight: 500; cursor: pointer; color: var(--text-color); }
        .privacy-section h4 { color: var(--heading-color); margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .privacy-section p, .privacy-section ul { margin-bottom: 1rem; }
        .privacy-section a { color: var(--accent-color); }
        .time-inputs { display: flex; gap: 1rem; align-items: flex-end; }
        .time-inputs > div { flex: 1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Astrological and Numerological Blueprint Calculator</h1>
        <div class="description">
            <h3>Your Complete Astrological Blueprint</h3>
            <p>
                This calculator provides a comprehensive analysis using the <strong>True Sidereal</strong> zodiac, which reflects the true, observable size of the constellations according to the official boundaries defined by the International Astronomical Union (IAU), including Ophiuchus.
            </p>
            <p>
                For a complete perspective, your report also includes a full chart calculated in the standard <strong>Tropical</strong> zodiac, allowing for direct comparison.
            </p>
            <p>
                <strong>Your personalized report features:</strong>
            </p>
            <ul>
                <li>An AI-powered astrological synthesis of your chart using Google's Gemini.</li>
                <li>A visual chart wheel showing your unique planetary alignment.</li>
                <li>Detailed Sidereal and Tropical placements for all planets and major points.</li>
                <li>In-depth analysis of aspects, patterns, and chart dominance.</li>
                <li>Your personal Numerology (Birth Date and Full Name) and Chinese Zodiac sign.</li>
            </ul>
            <p>For a full analysis of your chart, or for any questions, please contact: <a href="mailto:synthesisastrology@outlook.com">synthesisastrology@outlook.com</a></p>
            <p>
                Enter your birth details below to generate your complete astrological profile.
            </p>
        </div>

        <form id="chartForm">
            <label for="fullName">Full Birth Name (including middle name for numerology)</label>
            <input type="text" id="fullName" name="fullName" required value="">
            <label for="birthDate">Birth Date (MM/DD/YYYY)</label>
            <input type="text" id="birthDate" name="birthDate" required value="" placeholder="e.g., 05/15/1992">
            <p class="time-note">For the most accurate results, please use your exact time of birth. If you do not know it within an hour, you can select the checkbox below to exclude time sensitive information from the output.</p>
            <div class="time-toggle">
                <input type="checkbox" id="unknownTime" name="unknownTime">
                <label for="unknownTime">I don't know my birth time</label>
            </div>
            <div class="time-inputs">
                <div>
                    <label for="hour">Hour</label>
                    <input type="number" id="hour" name="hour" required value="" min="1" max="12">
                </div>
                <div>
                    <label for="minute">Minute</label>
                    <input type="number" id="minute" name="minute" required value="" min="0" max="59">
                </div>
                <div>
                    <label for="ampm">AM/PM</label>
                    <select id="ampm" name="ampm">
                        <option value="am">AM</option>
                        <option value="pm">PM</option>
                    </select>
                </div>
            </div>
            <label for="location">Birth Location</label><input type="text" id="location" name="location" required value="">
            <button type="submit" id="submitBtn">Calculate Chart</button>
        </form>

        <h2 id="gemini-title" style="display: none;">AI Astrological Synthesis</h2>
        <pre id="gemini-output" style="display: none;"></pre>

        <h2 id="results-title">Results</h2>
        <pre id="output">Your personalized report will appear here.</pre>

        <h2 id="wheel-title">Chart Wheel</h2>
        <div id="chart-wheel-container">
            <svg id="chart-wheel-svg" viewBox="0 0 1000 1000"></svg>
        </div>

        <h2>Glyph Legend</h2>
        <pre id="glyph-legend"></pre>

        <div class="privacy-section">
            <details>
                <summary>Disclaimer</summary>
                <div>
                    <p>The information and data provided by the Astrological and Numerological Blueprint Calculator, including any AI-generated text from Google's Gemini model, are for entertainment and informational purposes only. The readings and interpretations are not intended to be a substitute for professional advice from a qualified person in any field, including but not to medical, financial, or legal matters.</p>
                    <p>By using this service, you agree that you are solely responsible for any actions you take based on the information provided, and you will not hold the website or its creator liable for any decisions or outcomes.</p>
                </div>
            </details>

            <details>
                <summary>Privacy Policy</summary>
                <div>
                    <h4>Last Updated: July 27, 2025</h4>
                    <p>Thank you for using the Astrological and Numerological Blueprint Calculator. This Privacy Policy explains what information we collect when you use our service, why we collect it, and how it is handled. Your privacy is important to us, and we are committed to being transparent about our data practices.</p>
                    <h4>1. Information We Collect</h4>
                    <p>When you use the calculator, we collect the following information that you voluntarily provide:</p>
                    <ul>
                        <li><strong>Name:</strong> The name you enter for the chart calculation.</li>
                        <li><strong>Birth Information:</strong> The date of birth (year, month, day) and time of birth (hour, minute) you provide.</li>
                        <li><strong>Location Information:</strong> The birth location (e.g., "Boston, MA") you enter.</li>
                    </ul>
                    <p>We <strong>do not</strong> collect your IP address or any other information that is not explicitly entered into the form fields.</p>
                    <h4>2. How We Use Your Information</h4>
                    <p>The information you provide is used for the following purposes:</p>
                    <ul>
                        <li><strong>To Perform Calculations:</strong> The data is sent to our secure server to perform the astrological and numerological calculations and generate your personalized report.</li>
                        <li><strong>To Generate AI Readings:</strong> Anonymized astrological data (your planetary positions, but not your name, date, time, or location) is sent to the Google Gemini API to generate the "AI Astrological Synthesis" portion of your report.</li>
                        <li><strong>Application Monitoring & Debugging:</strong> The input data is sent to a secure, third-party logging service (Better Stack) for the sole purpose of monitoring application performance, identifying bugs, and troubleshooting errors. This helps us ensure the calculator is running smoothly and accurately.</li>
                        <li><strong>Research and Service Improvement:</strong> May be used to analyze astrological patterns, conduct research, and train artificial intelligence designed to improve the accuracy and depth of our astrological readings and to further the study of astrology.</li>
                    </ul>
                    <h4>3. Data Storage and Sharing</h4>
                    <ul>
                        <li><strong>Storage:</strong> The data that is collected will be stored and may be used to develop artificial intelligence. The data is also stored locally.</li>
                        <li><strong>Sharing:</strong> We are committed to protecting your privacy. We will not sell or share your personal information with any other third parties. Anonymized astrological data is processed by Google's services to provide the AI reading, subject to their privacy policies.</li>
                    </ul>
                    <h4>4. Your Rights and Data Deletion</h4>
                    <p>You have the right to request the deletion of your personal data from our logs. If you would like to have your information removed, please contact us with the details of the data you entered (name, date, location), and we will permanently delete the corresponding log entries.</p>
                    <h4>5. Consent for Research Use</h4>
                    <p>By using this calculator, you acknowledge and consent that the birth data you provide may be used for the research and potential artificial intelligence training purposes described in Section 2. This is essential for helping us learn more about astrology and improve the quality of the service we provide to you and other users.</p>
                    <h4>6. Contact Us</h4>
                    <p>If you have any questions about this Privacy Policy or wish to request the deletion of your data, please contact us at:</p>
                    <p><a href="mailto:synthesisastrology@outlook.com"><strong>synthesisastrology@outlook.com</strong></a></p>
                </div>
            </details>

            <details>
                <summary>Terms of Service</summary>
                <div>
                    <h4>Last Updated: July 27, 2025</h4>
                    <p>Welcome to the Astrological and Numerological Blueprint Calculator. These Terms of Service ("Terms") govern your use of this website and the services provided. By accessing or using the service, you agree to be bound by these Terms.</p>
                    <h4>1. Description of Service</h4>
                    <p>This website provides personalized astrological and numerological reports based on data you provide, including True Sidereal and Tropical zodiac calculations, a visual chart wheel, and numerology reports. The service is provided for informational and entertainment purposes.</p>
                    <h4>2. Acceptance of Terms</h4>
                    <p>By using this service, you confirm that you have read, understood, and agree to be bound by these Terms. If you do not agree with the Terms, please do not use the service.</p>
                    <h4>3. Acceptable Use</h4>
                    <p>You agree not to use this service for any unlawful purpose or in any way that could damage, disable, or impair the service. This includes, but is not limited to:</p>
                    <ul>
                        <li>Submitting data through automated means (e.g., bots, scripts).</li>
                        <li>Attempting to gain unauthorized access to the server or its data.</li>
                        <li>Using the service for any commercial purpose without prior written consent.</li>
                    </ul>
                    <h4>4. Intellectual Property</h4>
                    <p>All content on this website, including the design, text, graphics, and the underlying source code of the calculator, are the intellectual property of the site owner. You may use the service for personal, non-commercial use only.</p>
                    <h4>5. Disclaimer of Warranties</h4>
                    <p>The information and data provided by this calculator are for <strong>entertainment and informational purposes only</strong>. The service is provided "as is" and "as available" without any warranties, express or implied. We do not warrant that the service will be error-free or that the information provided will be completely accurate. The interpretations are not a substitute for professional advice from a qualified person in any field, including but not limited to medical, financial, or legal matters.</p>
                    <h4>6. Limitation of Liability</h4>
                    <p>By using this service, you agree that you are solely responsible for any actions you take based on the information provided. The owner of this website shall not be held liable for any direct, indirect, incidental, or consequential damages resulting from the use or inability to use this service, or from any decisions or outcomes made in reliance on the information provided.</p>
                    <h4>7. Privacy Policy</h4>
                    <p>Your use of this service is also governed by our Privacy Policy, which is available on this website. The Privacy Policy explains how we collect, use, and protect your personal data.</p>
                    <h4>8. Changes to Terms</h4>
                    <p>We reserve the right to modify these Terms at any time. We will notify users of any changes by updating the "Last Updated" date at the top of this page. Your continued use of the service after such changes constitutes your acceptance of the new Terms.</p>
                    <h4>9. Contact Information</h4>
                    <p>If you have any questions about these Terms, please contact us at:<br><strong>synthesisastrology@outlook.com</strong></p>
                </div>
            </details>
        </div>
    </div>

    <script>
        const unknownTimeCheckbox = document.getElementById('unknownTime');
        const hourInput = document.getElementById('hour');
        const minuteInput = document.getElementById('minute');
        const ampmSelect = document.getElementById('ampm');

        unknownTimeCheckbox.addEventListener('change', function() {
            const isChecked = this.checked;
            hourInput.disabled = isChecked;
            minuteInput.disabled = isChecked;
            ampmSelect.disabled = isChecked;
            if (isChecked) {
                hourInput.value = '12';
                minuteInput.value = '00';
                ampmSelect.value = 'pm';
            }
        });
        
        document.getElementById("chartForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            const form = e.target, outputEl = document.getElementById("output"), btn = document.getElementById("submitBtn");
            const geminiTitle = document.getElementById('gemini-title');
            const geminiOutput = document.getElementById('gemini-output');

            btn.disabled = true; btn.innerText = "Calculating...";
            outputEl.innerText = "Calculating chart...";
            geminiTitle.style.display = 'none';
            geminiOutput.style.display = 'none';
            document.getElementById('chart-wheel-svg').innerHTML = '';

            try {
                const birthDateParts = form.querySelector("[name='birthDate']").value.split('/');
                if (birthDateParts.length !== 3) throw new Error("Please enter the date in MM/DD/YYYY format.");
                const [month, day, year] = birthDateParts.map(s => parseInt(s));

                let hour = parseInt(form.querySelector("[name='hour']").value);
                const ampm = form.querySelector("[name='ampm']").value;

                if (ampm === 'pm' && hour < 12) hour += 12;
                if (ampm === 'am' && hour === 12) hour = 0;

                const apiRes = await fetch("https://true-sidereal-api.onrender.com/calculate_chart", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        full_name: form.querySelector("[name='fullName']").value,
                        year: year,
                        month: month,
                        day: day,
                        hour: hour,
                        minute: parseInt(form.querySelector("[name='minute']").value),
                        location: form.querySelector("[name='location']").value,
                        unknown_time: form.querySelector("[name='unknownTime']").checked
                    }),
                });

                if (!apiRes.ok) { 
                    const errData = await apiRes.json();
                    throw new Error(`API Error ${apiRes.status}: ${errData.detail}`); 
                }
                const result = await apiRes.json();
                
                if (result.gemini_reading) {
                    geminiTitle.style.display = 'block';
                    geminiOutput.style.display = 'block';
                    geminiOutput.innerText = result.gemini_reading;
                }
                
                renderResults(result);
                
                if (!result.unknown_time) {
                    drawChartWheel(result);
                }
            } catch (err) {
                outputEl.innerText = "Error: " + err.message;
            } finally {
                btn.disabled = false;
                btn.innerText = "Calculate Chart";
            }
        });

        function renderResults(res) {
            const wheelContainer = document.getElementById('chart-wheel-container');
            const wheelTitle = document.getElementById('wheel-title');
            if (res.unknown_time) {
                wheelContainer.style.display = 'none';
                wheelTitle.style.display = 'none';
            } else {
                wheelContainer.style.display = 'flex';
                wheelTitle.style.display = 'block';
            }
            let out = `=== TRUE SIDEREAL CHART: ${res.name} ===\n`;
            out += `- UTC Date & Time: ${res.utc_datetime}${res.unknown_time ? ' (Noon Estimate)' : ''}\n`;
            out += `- Location: ${res.location}\n`;
            out += `- Day/Night Determination: ${res.day_night_status}\n\n`;
            out += `-- CHART ANALYSIS --\n`;
            out += `- Chart Ruler: ${res.sidereal_chart_analysis.chart_ruler}\n`;
            out += `- Dominant Sign: ${res.sidereal_chart_analysis.dominant_sign}\n`;
            out += `- Dominant Element: ${res.sidereal_chart_analysis.dominant_element}\n`;
            out += `- Dominant Modality: ${res.sidereal_chart_analysis.dominant_modality}\n`;
            out += `- Dominant Planet: ${res.sidereal_chart_analysis.dominant_planet}\n`;
            out += `- Life Path Number: ${res.sidereal_chart_analysis.life_path_number}\n`;
            out += `- Day Number: ${res.sidereal_chart_analysis.day_number}\n`;
            out += `- Chinese Zodiac: ${res.sidereal_chart_analysis.chinese_zodiac}\n`;
            if (res.sidereal_chart_analysis.name_numerology) {
                out += `\n-- NAME NUMEROLOGY --\n`;
                out += `- Expression (Destiny) Number: ${res.sidereal_chart_analysis.name_numerology.expression_number}\n`;
                out += `- Soul Urge Number: ${res.sidereal_chart_analysis.name_numerology.soul_urge_number}\n`;
                out += `- Personality Number: ${res.sidereal_chart_analysis.name_numerology.personality_number}\n`;
            }
            out += `\n--- MAJOR POSITIONS ---\n`;
            res.sidereal_major_positions.forEach(p => {
                let line = `- ${p.name}: ${p.position}`;
                if (!['Ascendant', 'Descendant', 'Midheaven (MC)', 'Imum Coeli (IC)', 'South Node'].includes(p.name)) {
                    line += ` (${p.percentage}%)`;
                }
                if (p.retrograde) { line += " (Rx)"; }
                if (p.house_info) { line += ` ${p.house_info}`; }
                out += `${line}\n`;
            });
            out += `\n--- MAJOR ASPECTS (ranked by influence score) ---\n`;
            res.sidereal_aspects.forEach(a => { out += `- ${a.p1_name} ${a.type} ${a.p2_name} (orb ${a.orb}, score ${a.score})\n`; });
            out += `\n--- ASPECT PATTERNS ---\n`;
            (res.sidereal_aspect_patterns && res.sidereal_aspect_patterns.length > 0) ? res.sidereal_aspect_patterns.forEach(p => { out += `- ${p}\n`; }) : out += "- No major aspect patterns detected.\n";
            if (!res.unknown_time) {
                out += `\n--- ADDITIONAL POINTS & ANGLES ---\n`;
                res.sidereal_additional_points.forEach(p => { 
                    let line = `- ${p.name}: ${p.info}`;
                    if (p.retrograde) { line += " (Rx)"; }
                    out += `${line}\n`; 
                });
                out += `\n--- HOUSE RULERS ---\n`;
                for (const [house, info] of Object.entries(res.house_rulers)) { out += `- ${house}: ${info}\n`; }
                out += `\n--- HOUSE SIGN DISTRIBUTIONS ---\n`;
                for (const [house, segments] of Object.entries(res.house_sign_distributions)) {
                    out += `${house}:\n`;
                    if (segments && segments.length > 0) {
                        segments.forEach(seg => { out += `     - ${seg}\n`; });
                    }
                }
            } else {
                 out += `\n- (House Rulers, House Distributions, and some additional points require a known birth time and are not displayed.)\n`;
            }

            if (res.tropical_major_positions && res.tropical_major_positions.length > 0) {
                out += `\n\n\n=== TROPICAL CHART ===\n\n`;
                out += `-- CHART ANALYSIS --\n`;
                out += `- Dominant Sign: ${res.tropical_chart_analysis.dominant_sign}\n`;
                out += `- Dominant Element: ${res.tropical_chart_analysis.dominant_element}\n`;
                out += `- Dominant Modality: ${res.tropical_chart_analysis.dominant_modality}\n`;
                out += `- Dominant Planet: ${res.tropical_chart_analysis.dominant_planet}\n\n`;
                out += `--- MAJOR POSITIONS ---\n`;
                res.tropical_major_positions.forEach(p => {
                    let line = `- ${p.name}: ${p.position}`;
                    if (!['Ascendant', 'Descendant', 'Midheaven (MC)', 'Imum Coeli (IC)', 'South Node'].includes(p.name)) {
                        line += ` (${p.percentage}%)`;
                    }
                    if (p.retrograde) { line += " (Rx)"; }
                    if (p.house_info) { line += ` ${p.house_info}`; }
                    out += `${line}\n`;
                });
                out += `\n--- MAJOR ASPECTS (ranked by influence score) ---\n`;
                res.tropical_aspects.forEach(a => { out += `- ${a.p1_name} ${a.type} ${a.p2_name} (orb ${a.orb}, score ${a.score})\n`; });
                out += `\n--- ASPECT PATTERNS ---\n`;
                (res.tropical_aspect_patterns && res.tropical_aspect_patterns.length > 0) ? res.tropical_aspect_patterns.forEach(p => { out += `- ${p}\n`; }) : out += "- No major aspect patterns detected.\n";
                if (!res.unknown_time) {
                    out += `\n--- ADDITIONAL POINTS & ANGLES ---\n`;
                    res.tropical_additional_points.forEach(p => { 
                        let line = `- ${p.name}: ${p.info}`;
                        if (p.retrograde) { line += " (Rx)"; }
                        out += `${line}\n`; 
                    });
                }
            }

            document.getElementById("output").innerText = out;
        }

        const SVG_NS = "http://www.w3.org/2000/svg";
        const ZODIAC_GLYPHS = {'Aries':'♈︎','Taurus':'♉︎','Gemini':'♊︎','Cancer':'♋︎','Leo':'♌︎','Virgo':'♍︎','Libra':'♎︎','Scorpio':'♏︎','Ophiuchus':'⛎︎','Sagittarius':'♐︎','Capricorn':'♑︎','Aquarius':'♒︎','Pisces':'♓︎'};
        const PLANET_GLYPHS = {'Sun':'☉','Moon':'☽','Mercury':'☿','Venus':'♀','Mars':'♂','Jupiter':'♃','Saturn':'♄','Uranus':'♅','Neptune':'♆','Pluto':'♇','Chiron':'⚷','True Node':'☊','South Node':'☋','Ascendant':'AC','Midheaven (MC)':'MC','Descendant':'DC','Imum Coeli (IC)':'IC'};

        function drawChartWheel(data) {
            const svg = document.getElementById('chart-wheel-svg');
            svg.innerHTML = ''; 

            const centerX = 500;
            const centerY = 500;
            const zodiacRadius = 450;
            const houseRingRadius = 350;
            const planetGlyphRadius = 320;
            const innerRadius = 150;
            
            const ascendant = data.sidereal_major_positions.find(p => p.name === 'Ascendant');
            if (!ascendant || ascendant.degrees === null) {
                svg.innerHTML = '<text x="500" y="500" class="house-number">Chart wheel requires a known birth time.</text>';
                return;
            }
            
            function degreeToCartesian(radius, angleDegrees) {
                const angleRadians = angleDegrees * (Math.PI / 180);
                return { 
                    x: centerX + radius * Math.cos(angleRadians), 
                    y: centerY - radius * Math.sin(angleRadians)
                };
            }

            const rotation = -ascendant.degrees;
            const mainGroup = document.createElementNS(SVG_NS, 'g');
            mainGroup.setAttribute('transform', `rotate(${rotation} ${centerX} ${centerY})`);
            svg.appendChild(mainGroup);

            if (data.sidereal_aspects) {
                data.sidereal_aspects.forEach(aspect => {
                    if (aspect.p1_degrees === null || aspect.p2_degrees === null) return;
                    const p1Coords = degreeToCartesian(innerRadius, aspect.p1_degrees);
                    const p2Coords = degreeToCartesian(innerRadius, aspect.p2_degrees);
                    const line = document.createElementNS(SVG_NS, 'line');
                    line.setAttribute('x1', p1Coords.x); line.setAttribute('y1', p1Coords.y);
                    line.setAttribute('x2', p2Coords.x); line.setAttribute('y2', p2Coords.y);
                    const aspectClass = aspect.type.toLowerCase().replace(' ', '-');
                    line.setAttribute('class', `aspect-line aspect-${aspectClass}`);
                    mainGroup.appendChild(line);
                });
            }

            [zodiacRadius, houseRingRadius, innerRadius].forEach(r => {
                const circle = document.createElementNS(SVG_NS, 'circle');
                circle.setAttribute('cx', centerX); circle.setAttribute('cy', centerY);
                circle.setAttribute('r', r); circle.setAttribute('class', 'wheel-circle');
                svg.appendChild(circle);
            });
            
            if (data.true_sidereal_signs) {
                const glyphRadius = houseRingRadius + (zodiacRadius - houseRingRadius) / 2;
                data.true_sidereal_signs.forEach(sign => {
                    const [name, start, end] = sign;
                    const startPoint = degreeToCartesian(houseRingRadius, start);
                    const endPoint = degreeToCartesian(zodiacRadius, start);
                    const line = document.createElementNS(SVG_NS, 'line');
                    line.setAttribute('x1', startPoint.x); line.setAttribute('y1', startPoint.y);
                    line.setAttribute('x2', endPoint.x); line.setAttribute('y2', endPoint.y);
                    line.setAttribute('class', 'zodiac-divider');
                    mainGroup.appendChild(line);
                    const midAngle = start + ((end - start + 360) % 360) / 2;
                    const textCoords = degreeToCartesian(glyphRadius, midAngle);
                    const text = document.createElementNS(SVG_NS, 'text');
                    text.setAttribute('x', textCoords.x);
                    text.setAttribute('y', textCoords.y);
                    text.setAttribute('class', 'zodiac-glyph');
                    text.setAttribute('transform', `rotate(${-rotation} ${textCoords.x} ${textCoords.y})`);
                    text.textContent = ZODIAC_GLYPHS[name];
                    mainGroup.appendChild(text);
                });
            }

            if (data.house_cusps && data.house_cusps.length === 12) {
                data.house_cusps.forEach((cuspDegrees, i) => {
                    const startPoint = degreeToCartesian(innerRadius, cuspDegrees);
                    const endPoint = degreeToCartesian(houseRingRadius, cuspDegrees);
                    const line = document.createElementNS(SVG_NS, 'line');
                    line.setAttribute('x1', startPoint.x); line.setAttribute('y1', startPoint.y);
                    line.setAttribute('x2', endPoint.x); line.setAttribute('y2', endPoint.y);
                    line.setAttribute('class', (i === 0 || i === 3 || i === 6 || i === 9) ? 'house-cusp major' : 'house-cusp');
                    mainGroup.appendChild(line);
                });
                for (let i = 0; i < 12; i++) {
                    const startAngle = data.house_cusps[i];
                    const endAngle = data.house_cusps[(i + 1) % 12];
                    let midAngle = (startAngle + endAngle) / 2;
                    if (endAngle < startAngle) midAngle = ((startAngle + endAngle + 360) / 2) % 360;
                    const textCoords = degreeToCartesian(innerRadius - 30, midAngle);
                    const text = document.createElementNS(SVG_NS, 'text');
                    text.setAttribute('x', textCoords.x);
                    text.setAttribute('y', textCoords.y);
                    text.setAttribute('class', 'house-number');
                    text.setAttribute('transform', `rotate(${-rotation} ${textCoords.x} ${textCoords.y})`);
                    text.textContent = i + 1;
                    mainGroup.appendChild(text);
                }
            }
            
            if (data.sidereal_major_positions) {
                data.sidereal_major_positions.forEach(planet => {
                    if (planet.degrees === null || !PLANET_GLYPHS[planet.name]) return;
                    const textCoords = degreeToCartesian(planetGlyphRadius, planet.degrees);
                    const text = document.createElementNS(SVG_NS, 'text');
                    text.setAttribute('x', textCoords.x);
                    text.setAttribute('y', textCoords.y);
                    text.setAttribute('class', 'planet-glyph');
                    text.setAttribute('transform', `rotate(${-rotation} ${textCoords.x} ${textCoords.y})`);
                    text.textContent = PLANET_GLYPHS[planet.name];
                    mainGroup.appendChild(text);
                    if (planet.retrograde) {
                        const rxCoords = degreeToCartesian(planetGlyphRadius, planet.degrees - 4);
                        const rxText = document.createElementNS(SVG_NS, 'text');
                        rxText.setAttribute('x', rxCoords.x);
                        rxText.setAttribute('y', rxCoords.y);
                        rxText.setAttribute('class', 'planet-retrograde');
                        rxText.setAttribute('transform', `rotate(${-rotation} ${rxCoords.x} ${rxCoords.y})`);
                        rxText.textContent = '℞';
                        mainGroup.appendChild(rxText);
                    }
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const legendEl = document.getElementById('glyph-legend');
            let legendText = '--- ZODIAC SIGNS ---\n';
            for (const [name, glyph] of Object.entries(ZODIAC_GLYPHS)) {
                legendText += `${glyph} - ${name}\n`;
            }
            legendText += '\n--- PLANETS & POINTS ---\n';
            for (const [name, glyph] of Object.entries(PLANET_GLYPHS)) {
                legendText += `${glyph} - ${name}\n`;
            }
            legendEl.innerText = legendText;
        });
    </script>
</body>
</html>
