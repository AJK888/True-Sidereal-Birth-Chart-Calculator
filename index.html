<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthesis Astrology</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #fdf6e3;
            --card-background: #fdf6e3;
            --text-color: #38332a;
            --heading-color: #26221b;
            --accent-color: #b91c1c;
            --accent-hover: #991b1b;
            --border-color: #26221b;
            --pre-background: #f3eade;
            --aspect-hard: #b91c1c;
            --aspect-soft: #0b5f8a;
            --aspect-neutral: #15803d;
        }
        
        body {
            font-family: 'Lora', serif;
            line-height: 1.8;
            padding: 2rem;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container { max-width: 800px; width: 100%; }
        h1, h2 {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            color: var(--heading-color);
            text-align: center;
            font-weight: 700;
        }
        h1 { font-size: 3rem; margin-bottom: 0.5rem; }
        h2 { font-size: 1.5rem; margin-top: 3rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem; }
        .description, form, pre {
            background-color: var(--card-background);
            padding: 2rem;
            border-radius: 4px;
            margin: 1.5rem 0;
            border: 2px solid var(--border-color);
            box-shadow: 6px 6px 0px var(--border-color);
        }
        .description h3 { font-family: 'Oswald', sans-serif; text-transform: uppercase; margin-top: 0; color: var(--heading-color); }
        .description a { color: var(--accent-color); text-decoration: none; font-weight: 700; }
        .description a:hover { text-decoration: underline; }
        
        label { font-weight: 700; display: block; margin-top: 1rem; margin-bottom: 0.5rem; }
        input[type="text"], input[type="number"], select {
            display: block;
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #fff;
            color: var(--text-color);
            font-size: 1rem;
            font-family: 'Lora', serif;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        button {
            width: 100%;
            padding: 0.85rem;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            color: var(--bg-color);
            background-color: var(--accent-color);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            margin-top: 2rem;
            box-shadow: 4px 4px 0px var(--border-color);
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
        }
        button:hover:not(:disabled) {
            background-color: var(--accent-hover);
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--border-color);
        }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        pre { white-space: pre-wrap; word-break: break-word; font-family: "Courier New", Courier, monospace; font-size: 14px; background-color: var(--pre-background); }
        #gemini-output { font-family: 'Lora', serif; font-size: 1.1rem; line-height: 1.8; }
        
        #chart-wheel-container { display: flex; justify-content: center; align-items: center; margin-top: 2rem; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; }
        #chart-wheel-svg { width: 100%; height: auto; aspect-ratio: 1 / 1; }
        .wheel-circle { stroke: var(--border-color); stroke-width: 2; fill: none; }
        .zodiac-divider { stroke: var(--border-color); stroke-width: 1; }
        .house-cusp { stroke: var(--text-color); stroke-width: 2; }
        .house-cusp.major { stroke-width: 4; }
        .house-number { fill: var(--text-color); font-size: 28px; font-family: 'Lora', serif; text-anchor: middle; dominant-baseline: middle; }
        .zodiac-glyph { fill: var(--text-color); font-size: 35px; text-anchor: middle; dominant-baseline: middle; }
        .planet-glyph { fill: var(--heading-color); font-size: 35px; text-anchor: middle; dominant-baseline: middle; }
        .planet-retrograde { fill: var(--text-color); font-size: 20px; }
        .aspect-line { stroke-width: 1.5; opacity: 0.9; }
        .aspect-conjunction { stroke: var(--aspect-neutral); }
        .aspect-opposition, .aspect-square { stroke: var(--aspect-hard); }
        .aspect-trine, .aspect-sextile { stroke: var(--aspect-soft); }
        .aspect-quincunx, .aspect-semisextile, .aspect-semisquare, .aspect-sesquiquadrate, .aspect-quintile, .aspect-biquintile { stroke: var(--border-color); stroke-dasharray: 4 4; opacity: 0.6; }
        
        .time-toggle { display: flex; align-items: center; margin-top: 1.5rem; }
        .time-toggle input { width: auto; margin-right: 0.75rem; }
        .time-toggle label { margin: 0; }
        .time-note { font-size: 0.9rem; color: #5e5544; margin-top: 1.5rem; }
        .privacy-section { margin-top: 4rem; padding-top: 2rem; border-top: 2px solid var(--border-color); font-size: 0.9rem; color: #5e5544; }
        .privacy-section details { background-color: var(--card-background); border-radius: 4px; border: 2px solid var(--border-color); padding: 1rem 1.5rem; margin-bottom: 1rem; }
        .privacy-section summary { font-weight: 700; cursor: pointer; color: var(--text-color); }
        .privacy-section h4 { color: var(--heading-color); margin-top: 1.5rem; margin-bottom: 0.5rem; font-family: 'Oswald', sans-serif; }
        .privacy-section p, .privacy-section ul { margin-bottom: 1rem; }
        .privacy-section a { color: var(--accent-color); }
        .time-inputs { display: flex; gap: 1rem; align-items: flex-end; }
        .time-inputs > div { flex: 1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Synthesis Astrology</h1>

        <div class="description glass-card">
            <p>Welcome to a highly advanced astrology calculator designed for public use.</p>
            <p>Astrology is a powerful tool for insight and self-development. This platform combines modern technology with ancient wisdom to provide a comprehensive analysis of your unique birth chart.</p>
            <p><strong>What youâ€™ll receive:</strong></p>
            <ul>
                <li>A brief professional reading powered by artificial intelligence, highlighting key themes and insights from your chart.</li>
                <li>A visual True Sidereal chart wheel displaying your planetary alignments.</li>
                <li>Full planetary placements using both the <strong>True Sidereal</strong> and <strong>Tropical</strong> zodiacs.</li>
                <li>Analysis of key aspects, planetary patterns, and chart dominance.</li>
                <li>Your personal Numerology and Chinese Zodiac sign.</li>
            </ul>
            <p>For questions or a deeper personal analysis, feel free to contact: <a href="mailto:synthesisastrology@outlook.com">synthesisastrology@outlook.com</a></p>
        </div>

        <form id="chartForm" class="glass-card">
             <label for="fullName">Full Birth Name</label>
            <input type="text" id="fullName" name="fullName" required>
            
            <label for="birthDate">Birth Date</label>
            <input type="text" id="birthDate" name="birthDate" required placeholder="MM/DD/YYYY">

            <p class="time-note">For the most accurate results, please enter your exact birth time.</p>
            <div class="time-toggle">
                <input type="checkbox" id="unknownTime" name="unknownTime">
                <label for="unknownTime">I don't know my birth time</label>
            </div>

            <div class="time-inputs">
                <div> <label for="hour">Hour</label> <input type="number" id="hour" name="hour" required min="1" max="12"> </div>
                <div> <label for="minute">Minute</label> <input type="number" id="minute" name="minute" required min="0" max="59"> </div>
                <div> <label for="ampm">AM/PM</label> <select id="ampm" name="ampm"><option value="am">AM</option><option value="pm">PM</option></select> </div>
            </div>
            
            <label for="location">Birth Location</label>
            <input type="text" id="location" name="location" required placeholder="City, State, Country">
            
            <button type="submit" id="submitBtn">Generate My Blueprint</button>
        </form>

        <div id="wheel-title" class="result-section">
            <h2>Chart Wheel</h2>
            <div id="chart-wheel-container"><svg id="chart-wheel-svg" viewBox="-100 -100 1200 1200"></svg></div>
        </div>

        <div id="gemini-title" class="result-section">
            <h2>AI Astrological Synthesis</h2>
            <pre id="gemini-output" class="glass-card"></pre>
        </div>

        <div id="results-title" class="result-section">
            <h2>Full Report</h2>
            <pre id="output"></pre>
        </div>

        <div id="legend-title" class="result-section">
            <h2>Glyph Legend</h2>
            <pre id="glyph-legend"></pre>
        </div>

        <div class="privacy-section">
            <details>
                <summary>Disclaimer, Privacy & Terms</summary>
                <div>
                    </div>
            </details>
        </div>
    </div>

    <script>
    const AstrologyCalculator = {
        // ... (The full JS object from the last version goes here, unchanged) ...
        // UPDATE: The only minor change is to the display functions
        // to handle the new animation classes.

        displayInitialResults(chartData) {
            // Show AI section with a loading message
            document.getElementById('gemini-title').classList.add('visible');
            this.geminiOutput.innerText = "Generating AI Synthesis...";
            
            // Display the main text report
            document.getElementById('results-title').classList.add('visible');
            this.renderTextResults(chartData);

            // Display wheel and legend if time is known
            if (!chartData.unknown_time) {
                document.getElementById('wheel-title').classList.add('visible');
                document.getElementById('legend-title').classList.add('visible');
                this.drawChartWheel(chartData);
            }
        },

        async fetchAndDisplayAIReading(chartData) {
            try {
                // ... (fetch logic is the same)
                const readingRes = await fetch(this.API_URLS.reading, { /*...*/ });
                if (!readingRes.ok) throw new Error('AI Reading service failed.');
                const readingResult = await readingRes.json();
                this.geminiOutput.innerText = readingResult.gemini_reading || "The AI reading could not be generated at this time.";
            } catch (err) {
                this.geminiOutput.innerText = "Error: The AI reading is currently unavailable. " + err.message;
            }
        },

        setLoadingState(isLoading) {
            this.submitBtn.disabled = isLoading;
            this.submitBtn.innerText = isLoading ? "Calculating..." : "Generate My Blueprint";

            if (isLoading) {
                // Hide all result sections by removing the 'visible' class
                document.querySelectorAll('.result-section').forEach(el => {
                    el.classList.remove('visible');
                });
                
                this.outputEl.innerText = "Calculating your chart...";
                document.getElementById('results-title').classList.add('visible');
            }
        },
    };

    // NOTE: For brevity, the rest of the JS object is omitted.
    // Please use the full JS from the previous step.
    </script>
</body>
</html>
