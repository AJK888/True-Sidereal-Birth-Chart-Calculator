<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthesis Astrology</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0c0a1a;
            --glass-bg: rgba(20, 18, 48, 0.5);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-color: #e0e0e0;
            --heading-color: #ffffff;
            --accent-color: #a78bfa;
            --accent-hover: #c4b5fd;
            --shadow-color: rgba(167, 139, 250, 0.3);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes backgroundPan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.7;
            padding: 2rem;
            margin: 0;
            color: var(--text-color);
            background-color: var(--bg-color);
            background-image: linear-gradient(315deg, #1e1b4b 0%, #171339 25%, #0c0a1a 50%, #1c194b 75%, #1e1b4b 100%);
            background-size: 200% 200%;
            animation: backgroundPan 30s linear infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            animation: fadeIn 1s ease-out forwards;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            margin-top: 1.5rem;
        }

        h1, h2 {
            font-family: 'Playfair Display', serif;
            color: var(--heading-color);
            text-align: center;
            font-weight: 700;
        }

        h1 { font-size: 3rem; margin-bottom: 0.5rem; }
        h2 { font-size: 1.75rem; margin-top: 3rem; border-bottom: 2px solid var(--glass-border); padding-bottom: 0.5rem; }
        h3 { color: var(--heading-color); }

        .description p, .description li, .description a {
            font-size: 1.1rem;
        }
        .description a { color: var(--accent-color); text-decoration: none; font-weight: 500; transition: color 0.3s ease; }
        .description a:hover { color: var(--accent-hover); }

        label {
            font-weight: 500;
            display: block;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--heading-color);
        }

        input[type="text"], input[type="number"], select {
            display: block;
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            box-sizing: border-box;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--shadow-color);
        }

        button {
            width: 100%;
            padding: 0.85rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: #fff;
            background-color: var(--accent-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 2rem;
            transition: all 0.3s ease;
        }

        button:hover:not(:disabled) {
            background-color: var(--accent-hover);
            box-shadow: 0 0 20px var(--shadow-color);
            transform: translateY(-2px);
        }

        button:disabled { opacity: 0.6; cursor: not-allowed; }

        pre {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            white-space: pre-wrap;
            word-break: break-word;
            font-family: "Courier New", Courier, monospace;
            font-size: 14px;
            color: var(--text-color);
            padding: 1.5rem;
        }
        
        #gemini-output { font-family: 'Inter', sans-serif; font-size: 1.1rem; line-height: 1.8; }
        
        .result-section {
            opacity: 0;
            transition: opacity 1s ease-out;
        }
        .result-section.visible {
            opacity: 1;
        }

        #chart-wheel-container { display: flex; justify-content: center; align-items: center; margin-top: 2rem; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; }
        #chart-wheel-svg { width: 100%; height: auto; aspect-ratio: 1 / 1; }
        .wheel-circle { stroke: var(--glass-border); stroke-width: 2; fill: none; }
        .zodiac-divider { stroke: var(--glass-border); stroke-width: 1; }
        .house-cusp { stroke: var(--text-color); stroke-width: 1.5; }
        .house-cusp.major { stroke-width: 3; }
        .house-number { fill: var(--text-color); font-size: 24px; font-family: 'Inter', sans-serif; text-anchor: middle; dominant-baseline: middle; opacity: 0.8;}
        .zodiac-glyph { fill: var(--text-color); font-size: 30px; text-anchor: middle; dominant-baseline: middle; }
        .planet-glyph { fill: var(--heading-color); font-size: 35px; text-anchor: middle; dominant-baseline: middle; }
        .planet-retrograde { fill: var(--accent-color); font-size: 20px; }
        .aspect-line { stroke-width: 1.5; opacity: 0.6; }
        .aspect-conjunction { stroke: #4ade80; } /* Green */
        .aspect-opposition, .aspect-square { stroke: #f87171; } /* Red */
        .aspect-trine, .aspect-sextile { stroke: #60a5fa; } /* Blue */
        .aspect-quincunx, .aspect-semisextile, .aspect-semisquare, .aspect-sesquiquadrate, .aspect-quintile, .aspect-biquintile { stroke: var(--glass-border); stroke-dasharray: 4 4; }
        
        .time-toggle { display: flex; align-items: center; margin-top: 1.5rem; }
        .time-toggle input { width: auto; margin-right: 0.75rem; }
        .time-toggle label { margin: 0; }
        .time-note { font-size: 0.9rem; color: #a0aec0; margin-top: 1.5rem; }
        
        .privacy-section { margin-top: 4rem; text-align: center; }
        .privacy-section details { text-align: left; background-color: transparent; border: none; padding: 0; margin-bottom: 1rem; }
        .privacy-section summary { font-weight: 500; cursor: pointer; color: var(--accent-color); display: inline-block; }
        .privacy-section details div {
            margin-top: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            background: var(--glass-bg);
        }
        .time-inputs { display: flex; gap: 1rem; align-items: flex-end; }
        .time-inputs > div { flex: 1; }

    </style>
</head>
<body>
    <div class="container">
        <h1>Synthesis Astrology</h1>

        <div class="description glass-card">
            <p>Welcome to a highly advanced astrology calculator designed for public use.</p>
            <p>Astrology is a powerful tool for insight and self-development. This platform combines modern technology with ancient wisdom to provide a comprehensive analysis of your unique birth chart.</p>
            <p><strong>What youâ€™ll receive:</strong></p>
            <ul>
                <li>A brief professional reading powered by artificial intelligence, highlighting key themes and insights from your chart.</li>
                <li>A visual True Sidereal chart wheel displaying your planetary alignments.</li>
                <li>Full planetary placements using both the <strong>True Sidereal</strong> and <strong>Tropical</strong> zodiacs.</li>
                <li>Analysis of key aspects, planetary patterns, and chart dominance.</li>
                <li>Your personal Numerology and Chinese Zodiac sign.</li>
            </ul>
            <p>For questions or a deeper personal analysis, feel free to contact: <a href="mailto:synthesisastrology@outlook.com">synthesisastrology@outlook.com</a></p>
        </div>

        <form id="chartForm" class="glass-card">
             <label for="fullName">Full Birth Name</label>
            <input type="text" id="fullName" name="fullName" required>
            
            <label for="birthDate">Birth Date</label>
            <input type="text" id="birthDate" name="birthDate" required placeholder="MM/DD/YYYY">

            <p class="time-note">For the most accurate results, please enter your exact birth time.</p>
            <div class="time-toggle">
                <input type="checkbox" id="unknownTime" name="unknownTime">
                <label for="unknownTime">I don't know my birth time</label>
            </div>

            <div class="time-inputs">
                <div> <label for="hour">Hour</label> <input type="number" id="hour" name="hour" required min="1" max="12"> </div>
                <div> <label for="minute">Minute</label> <input type="number" id="minute" name="minute" required min="0" max="59"> </div>
                <div> <label for="ampm">AM/PM</label> <select id="ampm" name="ampm"><option value="am">AM</option><option value="pm">PM</option></select> </div>
            </div>
            
            <label for="location">Birth Location</label>
            <input type="text" id="location" name="location" required placeholder="City, State, Country">
            
            <button type="submit" id="submitBtn">Generate My Blueprint</button>
        </form>

        <div id="wheel-title" class="result-section">
            <h2>Chart Wheel</h2>
            <div id="chart-wheel-container"><svg id="chart-wheel-svg" viewBox="-100 -100 1200 1200"></svg></div>
        </div>

        <div id="gemini-title" class="result-section">
            <h2>AI Astrological Synthesis</h2>
            <pre id="gemini-output" class="glass-card"></pre>
        </div>

        <div id="results-title" class="result-section">
            <h2>Full Report</h2>
            <pre id="output"></pre>
        </div>

        <div id="legend-title" class="result-section">
            <h2>Glyph Legend</h2>
            <pre id="glyph-legend"></pre>
        </div>

        <div class="privacy-section">
            <details>
                <summary>Disclaimer, Privacy & Terms</summary>
                <div>
                    </div>
            </details>
        </div>
    </div>

    <script>
    const AstrologyCalculator = {
        // ... (The full JS object from the last version goes here, unchanged) ...
        // UPDATE: The only minor change is to the display functions
        // to handle the new animation classes.

        displayInitialResults(chartData) {
            // Show AI section with a loading message
            document.getElementById('gemini-title').classList.add('visible');
            this.geminiOutput.innerText = "Generating AI Synthesis...";
            
            // Display the main text report
            document.getElementById('results-title').classList.add('visible');
            this.renderTextResults(chartData);

            // Display wheel and legend if time is known
            if (!chartData.unknown_time) {
                document.getElementById('wheel-title').classList.add('visible');
                document.getElementById('legend-title').classList.add('visible');
                this.drawChartWheel(chartData);
            }
        },

        async fetchAndDisplayAIReading(chartData) {
            try {
                // ... (fetch logic is the same)
                const readingRes = await fetch(this.API_URLS.reading, { /*...*/ });
                if (!readingRes.ok) throw new Error('AI Reading service failed.');
                const readingResult = await readingRes.json();
                this.geminiOutput.innerText = readingResult.gemini_reading || "The AI reading could not be generated at this time.";
            } catch (err) {
                this.geminiOutput.innerText = "Error: The AI reading is currently unavailable. " + err.message;
            }
        },

        setLoadingState(isLoading) {
            this.submitBtn.disabled = isLoading;
            this.submitBtn.innerText = isLoading ? "Calculating..." : "Generate My Blueprint";

            if (isLoading) {
                // Hide all result sections by removing the 'visible' class
                document.querySelectorAll('.result-section').forEach(el => {
                    el.classList.remove('visible');
                });
                
                this.outputEl.innerText = "Calculating your chart...";
                document.getElementById('results-title').classList.add('visible');
            }
        },
    };

    // NOTE: For brevity, the rest of the JS object is omitted.
    // Please use the full JS from the previous step.
    </script>
</body>
</html>
