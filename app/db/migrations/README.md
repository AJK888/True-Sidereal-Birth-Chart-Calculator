# Database Migrations with Alembic

This directory contains Alembic database migration scripts.

## Setup

1. **Install Alembic** (if not already installed):
   ```bash
   pip install alembic
   ```

2. **Initialize Alembic** (first time only):
   ```bash
   cd "Synthesis Astrology/True-Sidereal-Birth-Chart"
   alembic init app/db/migrations
   ```
   
   Note: The migration directory structure is already created. You may need to copy `alembic.ini.template` to `alembic.ini` and update the `sqlalchemy.url` if needed.

3. **Create a new migration**:
   ```bash
   alembic revision --autogenerate -m "Description of changes"
   ```

4. **Review the generated migration**:
   - Check `app/db/migrations/versions/XXXX_description_of_changes.py`
   - Verify the changes are correct
   - Edit if needed

5. **Apply migrations**:
   ```bash
   alembic upgrade head
   ```

6. **Rollback a migration**:
   ```bash
   alembic downgrade -1  # Rollback one migration
   alembic downgrade <revision_id>  # Rollback to specific revision
   ```

## Important Notes

- **Always review autogenerated migrations** before applying them
- **Test migrations on a development database first**
- **Backup your database** before running migrations in production
- The `env.py` file is configured to use `DATABASE_URL` from `app.config`
- All models from `database.py` are automatically imported for autogenerate

## Migration Workflow

1. Make changes to models in `database.py`
2. Generate migration: `alembic revision --autogenerate -m "add new field"`
3. Review and edit the migration file
4. Test migration: `alembic upgrade head` (on dev database)
5. Commit migration file to version control
6. Apply to production: `alembic upgrade head`

## Current Status

- Migration system is set up but not yet initialized
- Run `alembic init app/db/migrations` to complete setup (or use existing structure)
- First migration should capture current database schema

